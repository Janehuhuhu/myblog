(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{456:function(t,s,a){"use strict";a.r(s);var n=a(45),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h3",{attrs:{id:"配置文件详解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置文件详解"}},[t._v("#")]),t._v(" 配置文件详解")]),t._v(" "),a("hr"),t._v(" "),a("h3",{attrs:{id:"nginx-文件结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx-文件结构"}},[t._v("#")]),t._v(" nginx 文件结构")]),t._v(" "),a("ul",[a("li",[t._v("全局块：配置影响nginx全局的指令。一般有运行nginx服务器的用户组，nginx进程pid存放路径，日志存放路径，配置文件引入，允许生成worker process数等。")]),t._v(" "),a("li",[t._v("events块：配置影响nginx服务器或与用户的网络连接。有每个进程的最大连接数，选取哪种事件驱动模型处理连接请求，是否允许同时接受多个网路连接，开启多个网络连接序列化等。")]),t._v(" "),a("li",[t._v("http块：可以嵌套多个server，配置代理，缓存，日志定义等绝大多数功能和第三方模块的配置。如文件引入，mime-type定义，日志自定义，是否使用sendfile传输文件，连接超时时间，单连接请求数等。")]),t._v(" "),a("li",[t._v("server块：配置虚拟主机的相关参数，一个http中可以有多个server。")]),t._v(" "),a("li",[t._v("location块：配置请求的路由，以及各种页面的处理情况。")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("              #全局块\n\nevents "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("         #events块\n   "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nhttp      #http块\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("   #http全局块\n    server        #server块\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("       #server全局块\n        location "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("PATTERN")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("   #location块\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        location "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("PATTERN")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" \n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    server\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("     #http全局块\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("div",{staticStyle:{"margin-top":"50px"}}),t._v(" "),a("h3",{attrs:{id:"模块详解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#模块详解"}},[t._v("#")]),t._v(" 模块详解")]),t._v(" "),a("h4",{attrs:{id:"全局块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#全局块"}},[t._v("#")]),t._v(" 全局块")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("#启动子进程程序默认用户或者组，默认为nobody nobody\n#user  nobody"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n#一个主进程和多个工作进程。工作进程是单进程的，且不需要特殊授权即可运行；这里定义的是工作进程数量，通常设置成和cpu的数量相等\nworker_processes  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n#全局错误日志的位置及日志级别。这个设置可以放入全局块，http块，server块，级别以此为：debug"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("info"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("notice"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("warn"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("error"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("crit"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("alert"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("emerg\n#error_log  logs"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n#error_log  logs"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("log  notice"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n#error_log  logs"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("log  info"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n#指定nginx进程运行文件存放地址\n#pid        logs"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h4",{attrs:{id:"events块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#events块"}},[t._v("#")]),t._v(" events块")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("events "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    accept_mutex on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   #设置网路连接序列化，防止惊群现象发生，默认为on\n    multi_accept on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  #设置一个进程是否同时接受多个网络连接，默认为off\n    #use epoll"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("      #事件驱动模型，select"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("poll"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("kqueue"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("epoll"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("resig"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("dev"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("poll"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("eventport\n    worker_connections  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("    #单个进程最大连接数\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h4",{attrs:{id:"http块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#http块"}},[t._v("#")]),t._v(" http块")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("http "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    #文件扩展名与文件类型映射表。"),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("Nginx")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v("通过服务器端文件的后缀名和"),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("mime.type")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v("来判断这个文件属于什么类型，再将该数据类型写入"),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("HTTP")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v("头部的"),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("Content-Typ")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v("e字段中，发送给客户端。\n    include       mime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("types"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    #默认文件类型，默认为text"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("plain\n    default_type  application"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("octet"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("stream"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    #日志格式\n    #log_format  main  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'$remote_addr - $remote_user [$time_local] \"$request\" '")]),t._v("\n    #                  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'$status $body_bytes_sent \"$http_referer\" '")]),t._v("\n    #                  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'"$http_user_agent" "$http_x_forwarded_for"\'')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    #全局访问日志路径 \n    #access_log  logs"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("access"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("log  main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    #sendfile指令指定 nginx 是否调用sendfile 函数（zero copy 方式）来输出文件，对于普通应用，必须设为on。如果用来进行下载等应用磁盘"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("IO")]),t._v("重负载应用，可设置为off，以平衡磁盘与网络"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("IO")]),t._v("处理速度，降低系统uptime。\n    sendfile        on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \n    #此选项允许或禁止使用socke的"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("TCP_CORK")]),t._v("的选项，此选项仅在使用sendfile的时候使用\n    #tcp_nopush     on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    #长连接超时时间\n    #keepalive_timeout  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    keepalive_timeout  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("65")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    #开启压缩\n    #gzip  on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("details",{staticClass:"custom-block details"},[a("summary",[t._v("日志格式参数")]),t._v(" "),a("ul",[a("li",[t._v("$remote_addr与$http_x_forwarded_for用以记录客户端的ip地址；")]),t._v(" "),a("li",[t._v("$remote_user：用来记录客户端用户名称；")]),t._v(" "),a("li",[t._v("$time_local： 用来记录访问时间与时区；")]),t._v(" "),a("li",[t._v("$request： 用来记录请求的url与http协议；")]),t._v(" "),a("li",[t._v("$status： 用来记录请求状态；成功是200，")]),t._v(" "),a("li",[t._v("$body_bytes_sent ：记录发送给客户端文件主体内容大小；")]),t._v(" "),a("li",[t._v("$http_referer：用来记录从那个页面链接访问过来的；")]),t._v(" "),a("li",[t._v("$http_user_agent：记录客户浏览器的相关信息；")])])]),t._v(" "),a("h4",{attrs:{id:"server块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#server块"}},[t._v("#")]),t._v(" server块")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    #虚拟主机使用的端口\n    listen       "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    #虚拟主机域名\n    server_name  localhost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    #虚拟主机支持的字符集\n    #charset koi8"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("r"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    #虚拟主机的访问日志路径\n    #access_log  logs"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("host"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("access"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("log  main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    #定义web根路径\n    location "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h4",{attrs:{id:"location块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#location块"}},[t._v("#")]),t._v(" location块")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("location "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    #根目录路径\n    root   html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    #索引页\n    index  index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("htm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("div",{staticStyle:{"margin-top":"50px"}}),t._v(" "),a("h3",{attrs:{id:"🔗-相关链接"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#🔗-相关链接"}},[t._v("#")]),t._v(" 🔗 相关链接")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://www.runoob.com/w3cnote/nginx-setup-intro.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("nginx详细配置"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://juejin.cn/post/6844903741678698510",target:"_blank",rel:"noopener noreferrer"}},[t._v("nginx.conf配置文件详解"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"http://www.360doc.com/content/19/0226/16/59494473_817687698.shtml",target:"_blank",rel:"noopener noreferrer"}},[t._v("mime.types"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://blog.huangfeiqiao.com/archives/nginx-internal-redirect.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("internal"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=e.exports}}]);