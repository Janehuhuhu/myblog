(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{460:function(t,a,s){"use strict";s.r(a);var n=s(45),r=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"npm-install原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#npm-install原理"}},[t._v("#")]),t._v(" npm install原理")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://cloud.tencent.com/developer/article/1555982",target:"_blank",rel:"noopener noreferrer"}},[t._v("npm install原理"),s("OutboundLink")],1)]),s("div",{staticStyle:{"margin-top":"50px"}}),s("p"),t._v(" "),s("h2",{attrs:{id:"npm-发包注意事项"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#npm-发包注意事项"}},[t._v("#")]),t._v(" npm - 发包注意事项")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://juejin.cn/post/6844903870678695943?utm_source=weibo&utm_campaign=user%3Futm_source%3Dweibo&utm_campaign=user",target:"_blank",rel:"noopener noreferrer"}},[t._v("发包基础"),s("OutboundLink")],1),t._v("、"),s("a",{attrs:{href:"https://blog.csdn.net/weixin_40817115/article/details/90384398",target:"_blank",rel:"noopener noreferrer"}},[t._v("npm version常用命令"),s("OutboundLink")],1)]),s("div",{staticStyle:{"margin-top":"50px"}}),s("p"),t._v(" "),s("h2",{attrs:{id:"修改-registry"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#修改-registry"}},[t._v("#")]),t._v(" 修改 registry")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 设置")]),t._v("\nnpm config "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("set")]),t._v(" registry https"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("registry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("npm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("taobao"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("org \n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 获取")]),t._v("\nnpm "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("get")]),t._v(" registry\n")])])]),s("p",[t._v("上述获取或设置的均是全局参数，如果想要修改某个仓库的：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 使用 .npmrc 文件")]),t._v("\nregistry "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" http"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("registry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("npm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("taobao"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("org\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 或者")]),t._v("\nnpm install "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("PACKAGE_NAME")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("registry https"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("registry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("npm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("taobao"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("org\n")])])]),s("div",{staticStyle:{"margin-top":"50px"}}),t._v(" "),s("h2",{attrs:{id:"pnpm-和-yarn2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pnpm-和-yarn2"}},[t._v("#")]),t._v(" pnpm 和 yarn2")]),t._v(" "),s("h3",{attrs:{id:"_4-1-为什么会引入-pnpm-和-yarn2-的概念"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-为什么会引入-pnpm-和-yarn2-的概念"}},[t._v("#")]),t._v(" 4.1 为什么会引入 pnpm 和 yarn2 的概念")]),t._v(" "),s("p",[t._v("项目中需要获取包版本，使用了 "),s("code",[t._v("node_modules")]),t._v("，具体如下:")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" cwd "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" pkgDir "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cwd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'node_modules/'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nversion "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sync")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" cwd"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" pkgDir "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("version\nmajorVersion "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" _"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("version"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'0'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("该种方式的问题是，获取的包版本是最外层，很可能不是实际上使用的包版本，这和 "),s("code",[t._v("npm")]),t._v(" 包寻址方式不符。另外，该方式不具有扩展性，未来 "),s("code",[t._v("pnpm")]),t._v(" 和 "),s("code",[t._v("yarn2")]),t._v(" 中通过 "),s("code",[t._v("node_modules")]),t._v(" 会拿不到实际使用的包内容")]),t._v(" "),s("p",[t._v("所以，优化后的方案如下：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" pkg "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/package.json'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nversion "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" pkg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("version\nmajorVersion "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("version"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'0'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("div",{staticStyle:{"margin-top":"50px"}}),t._v(" "),s("h3",{attrs:{id:"_4-2-常见问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-常见问题"}},[t._v("#")]),t._v(" 4.2 常见问题")]),t._v(" "),s("h4",{attrs:{id:"_4-2-1-为什么子包中-require-的寻址顺序一直是子包及父级地址而不是项目及父级地址"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-1-为什么子包中-require-的寻址顺序一直是子包及父级地址而不是项目及父级地址"}},[t._v("#")]),t._v(" 4.2.1 为什么子包中 require 的寻址顺序一直是子包及父级地址而不是项目及父级地址？")]),t._v(" "),s("p",[t._v("因为使用了 "),s("code",[t._v("yarn link")]),t._v("，所以会顺着子包及父级向上寻址\n")]),s("div",{staticStyle:{"margin-top":"30px"}}),s("p"),t._v(" "),s("h4",{attrs:{id:"_4-2-2-为啥项目中的依赖的依赖要用-dependencies"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-2-为啥项目中的依赖的依赖要用-dependencies"}},[t._v("#")]),t._v(" 4.2.2 为啥项目中的依赖的依赖要用 dependencies?")]),t._v(" "),s("p",[t._v("因为项目安装该依赖后并不会安装该依赖的 "),s("code",[t._v("devDependencies")]),t._v(" 类型依赖，他是开发时依赖。所以开发 "),s("code",[t._v("npm")]),t._v(" 的时候注意一些 "),s("code",[t._v("require")]),t._v(" 的运行时用的包一定要装在 "),s("code",[t._v("dependencies")]),t._v(" 中\n")]),s("div",{staticStyle:{"margin-top":"50px"}}),s("p"),t._v(" "),s("h3",{attrs:{id:"_4-3-pnpm-知识扫盲"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-pnpm-知识扫盲"}},[t._v("#")]),t._v(" 4.3 pnpm 知识扫盲")]),t._v(" "),s("p",[t._v("当你安装一个软件包，我们把它保存在你的机器上的一个全局存储目录中，然后我们创建一个硬链接而不是复制。 对于模块的每个版本，只会有一个副本保存在磁盘上。当使用 "),s("code",[t._v("npm")]),t._v(" 或 "),s("code",[t._v("yarn")]),t._v(" 时，如果有 "),s("em",[t._v("100")]),t._v(" 个使用 "),s("code",[t._v("lodash")]),t._v(" 的项目，你的磁盘上就会有有 "),s("em",[t._v("100")]),t._v(" 份 "),s("code",[t._v("lodash")]),t._v(" 的拷贝。"),s("code",[t._v("pnpm")]),t._v(" 能帮助您节省千兆字节的磁盘空间！")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://segmentfault.com/a/1190000013214927",target:"_blank",rel:"noopener noreferrer"}},[t._v("为什么用pnpm"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://pnpm.io/zh/motivation",target:"_blank",rel:"noopener noreferrer"}},[t._v("pnmp官网"),s("OutboundLink")],1)])]),t._v(" "),s("div",{staticStyle:{"margin-top":"50px"}}),t._v(" "),s("h3",{attrs:{id:"_4-4-yarn2知识扫盲"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-yarn2知识扫盲"}},[t._v("#")]),t._v(" 4.4 yarn2知识扫盲")]),t._v(" "),s("p",[s("code",[t._v("yarn2")]),t._v(" 将不再存在 "),s("code",[t._v("node_modules")]),t._v(" 文件夹，所有的依赖都会被压缩成一个文件放在特定的地方")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/107343333",target:"_blank",rel:"noopener noreferrer"}},[t._v("yarn2功能"),s("OutboundLink")],1),t._v(" "),s("div",{staticStyle:{"margin-top":"50px"}})])]),t._v(" "),s("h2",{attrs:{id:"npmrc-生效问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#npmrc-生效问题"}},[t._v("#")]),t._v(" npmrc 生效问题")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("在终端执行 "),s("em",[t._v("yarn add xxx")]),t._v(", 读取配置优先级为项目配置、用户、全局、"),s("em",[t._v("npm")]),t._v(" 本身的配置，"),s("em",[t._v("yarn")]),t._v(" 和 "),s("em",[t._v("npm")]),t._v(" 读取的都是 "),s("em",[t._v(".npmrc")]),t._v(" 的配置")])]),t._v(" "),s("li",[s("p",[t._v("在子进程中，"),s("em",[t._v("yarn")]),t._v(" 读取的是配置全局 "),s("em",[t._v("yarnrc")]),t._v("，项目用户配置 "),s("em",[t._v("npmrc、yarnrc")]),t._v(" 均不生效。"),s("em",[t._v("npm")]),t._v(" 命令读取的是 "),s("em",[t._v(".npmrc")]),t._v(", 优先级同 参考：\n"),s("a",{attrs:{href:"https://yanyinhong.github.io/2017/05/01/The-priority-of-npm-config/",target:"_blank",rel:"noopener noreferrer"}},[t._v("npmrc配置优先级"),s("OutboundLink")],1),t._v(" "),s("a",{attrs:{href:"https://juejin.cn/post/6983522411647860766",target:"_blank",rel:"noopener noreferrer"}},[t._v("npmrc配置方式"),s("OutboundLink")],1)])])]),t._v(" "),s("div",{staticStyle:{"margin-top":"50px"}}),t._v(" "),s("h2",{attrs:{id:"计算包体积"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#计算包体积"}},[t._v("#")]),t._v(" 计算包体积")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 终端执行以下命令，即可计算 node_modules 体积")]),t._v("\ndu "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("hd "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" node_modules\n")])])]),s("h2",{attrs:{id:"faq"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#faq"}},[t._v("#")]),t._v(" FAQ")]),t._v(" "),s("p",[t._v("6.1 Q: 报错 "),s("em",[t._v("name cannot start with an underscore; name can only contain URL-friendly characters")])]),t._v(" "),s("p",[t._v("A:")]),t._v(" "),s("ul",[s("li",[t._v("场景：在没有通过 "),s("code",[t._v("npm init")]),t._v(" 初始化目录的情况下，直接通过 "),s("code",[t._v("cnpm")]),t._v(" 命令安装模块，在卸载模块时报错"),s("br")]),t._v(" "),s("li",[t._v("原因分析：通过 "),s("code",[t._v("cnpm")]),t._v(" 命令安装模块时，会同时生成带下划线的文件（eg: _jquery@3.4.1@jquery)，不符合命名规范（根据报错提示）")]),t._v(" "),s("li",[t._v("解决方案：\n"),s("ul",[s("li",[t._v("方案一：安装模块时用npm，非cnpm(不建议)")]),t._v(" "),s("li",[t._v("方案二：先通过npm init初始化目录，生成包管理文件package.json，再安装模块（npm/cnpm）")]),t._v(" "),s("li",[t._v("方案三：安装包时后面加-D，会自动生成package.json文件\n如果无法卸载，可直接安装另一版本覆盖。\n"),s("div",{staticStyle:{"margin-top":"30px"}})])])])]),t._v(" "),s("p",[t._v("6.2 Q: "),s("em",[t._v("xxxxx is not a loader (must have normal or pitch function)")]),s("br"),t._v("\nA: 某安装包版本不匹配。")]),t._v(" "),s("div",{staticStyle:{"margin-top":"100px"}})])}),[],!1,null,null,null);a.default=r.exports}}]);