(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{391:function(t,s,a){t.exports=a.p+"assets/img/old-request.4238f38d.png"},392:function(t,s,a){t.exports=a.p+"assets/img/new-request.e7bd645d.png"},415:function(t,s,a){"use strict";a.r(s);var n=a(45),r=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h2",{attrs:{id:"é›†ç¾¤ä»‹ç»"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#é›†ç¾¤ä»‹ç»"}},[t._v("#")]),t._v(" é›†ç¾¤ä»‹ç»")]),t._v(" "),n("h3",{attrs:{id:"ä¼ ç»Ÿwebè®¿é—®æ¨¡å‹"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ä¼ ç»Ÿwebè®¿é—®æ¨¡å‹"}},[t._v("#")]),t._v(" ä¼ ç»Ÿwebè®¿é—®æ¨¡å‹")]),t._v(" "),n("img",{staticStyle:{"margin-top":"20px"},attrs:{src:a(391),width:"400px"}}),t._v(" "),n("br"),t._v(" "),n("p",[n("strong",[t._v("1. å®Œæˆä¸€æ¬¡è¯·æ±‚çš„æ­¥éª¤")]),n("br"),t._v("\n1ï¼‰ç”¨æˆ·å‘èµ·è¯·æ±‚"),n("br"),t._v("\n2ï¼‰æœåŠ¡å™¨æ¥å—è¯·æ±‚"),n("br"),t._v("\n3ï¼‰æœåŠ¡å™¨å¤„ç†è¯·æ±‚ï¼ˆå‹åŠ›æœ€å¤§ï¼‰"),n("br"),t._v("\n4ï¼‰æœåŠ¡å™¨å“åº”è¯·æ±‚"),n("br")]),t._v(" "),n("p",[n("strong",[t._v("2. ä¼ ç»Ÿæ¨¡å‹ç¼ºç‚¹")])]),t._v(" "),n("ul",[n("li",[t._v("å•ç‚¹æ•…éšœ")]),t._v(" "),n("li",[t._v("å•å°æœåŠ¡å™¨èµ„æºæœ‰é™ï¼ˆå®¢æˆ·ç«¯åˆ™æ˜¯æ— é™çš„ï¼‰ï¼›")]),t._v(" "),n("li",[t._v("å•å°æœåŠ¡å™¨å¤„ç†è€—æ—¶é•¿ï¼ˆå®¢æˆ·ç­‰å¾…æ—¶é—´è¿‡é•¿ï¼‰ï¼›")])]),t._v(" "),n("p",[n("strong",[t._v("3. ä¼ ç»Ÿæ¨¡å‹ä¼˜åŒ–â€”â€”å•ç‚¹æ•…éšœè§£å†³æ–¹æ¡ˆ")]),n("br"),t._v("\néƒ¨ç½²ä¸€å°å¤‡ä»½æœåŠ¡å™¨ï¼Œå®•æœºç›´æ¥åˆ‡æ¢è¯¥æ–¹æ¡ˆå¯ä»¥æœ‰æ•ˆè§£å†³æœåŠ¡å™¨æ•…éšœå¯¼è‡´çš„å•ç‚¹æ•…éšœï¼Œä½†ä¸”æœåŠ¡å™¨åˆ©ç”¨ç‡ä½ã€æˆæœ¬é«˜ï¼Œåˆ‡æ¢ä¸åŠæ—¶ï¼Œä¸”æ— æ³•è§£å†³æœåŠ¡å™¨ä¸šåŠ¡å‹åŠ›é—®é¢˜ã€‚\n")]),n("div",{staticStyle:{"margin-top":"50px"}}),n("p"),t._v(" "),n("h3",{attrs:{id:"é›†ç¾¤æ¨¡å¼"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#é›†ç¾¤æ¨¡å¼"}},[t._v("#")]),t._v(" é›†ç¾¤æ¨¡å¼")]),t._v(" "),n("img",{staticStyle:{"margin-top":"20px"},attrs:{src:a(392),width:"400px"}}),t._v(" "),n("div",{staticStyle:{"margin-top":"30px"}}),t._v(" "),n("p",[t._v("â€‹ä¸¤å°è´Ÿè½½å‡è¡¡ä¸»æœºä¸€ä¸ªä¸ºä¸»æœåŠ¡å™¨ï¼Œå¦å¤–ä¸€ä¸ªä¸ºå¤‡ç”¨æœåŠ¡å™¨ï¼Œä»–ä»¬ï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œä¸»æœåŠ¡å™¨ä¼šç»‘å®šä¸€ä¸ªè™šIPï¼ˆVirtual IPï¼‰ï¼Œ"),n("code",[t._v("DNS")]),t._v("å°†åŸŸåè§£æä¸ºè™šæ‹Ÿ"),n("code",[t._v("IP")]),t._v("ï¼Œå®¢æˆ·ç«¯çš„è¯·æ±‚åˆ°è¾¾è´Ÿè½½å‡è¡¡å™¨åï¼Œç”±è´Ÿè½½å‡è¡¡å°†è¯·æ±‚äº¤ç»™åç«¯çš„webæœåŠ¡å™¨ï¼Œå¦‚æœä¸»æœåŠ¡å™¨å®•æœºï¼Œåˆ™å¤‡ç”¨æœåŠ¡å™¨ä¼šè‡ªåŠ¨ç»‘å®šè¿™ä¸ªè™šæ‹ŸIPï¼Œç»§ç»­è¿›è¡Œåˆ†å‘å·¥ä½œï¼Œè¿™ä¸€åˆ‡å¯¹äºç”¨æˆ·è€Œè¨€æ˜¯é€æ˜çš„")]),t._v(" "),n("p",[t._v("â€‹"),n("strong",[t._v("ä¼˜ç‚¹")]),t._v("ï¼š ä¸éœ€è¦è°ƒæ•´"),n("code",[t._v("dns")]),t._v("æœåŠ¡å™¨ï¼Œå› ä¸ºæ˜¯ç”¨è¿‡ç›¸åº”çš„è½¯ä»¶æ¥å®ç°è´Ÿè½½å‡è¡¡çš„ï¼Œå¹¶ä¸”åªéœ€è¦ä¸€ä¸ªå…¬ç½‘"),n("code",[t._v("IP")]),t._v("åœ°å€åšä¸ºè™šæ‹Ÿ"),n("code",[t._v("IP")]),t._v("å°±å¯ä»¥äº†ï¼Œè¿˜èƒ½åšåˆ°éšæ—¶æ‰©å®¹ï¼Œå¦‚æœåç«¯çš„"),n("code",[t._v("web")]),t._v("æœåŠ¡å™¨å®•æœºï¼Œè´Ÿè½½å‡è¡¡å™¨ä¼šå°†å…¶ä»åˆ†å‘åˆ—è¡¨é‡Œå‰”é™¤ï¼ŒçœŸæ­£çš„å®ç°çš„ç½‘ç«™çš„é«˜åº¦å¯ç”¨ï¼Œå› ä¸ºè´Ÿè½½å‡è¡¡å™¨æœ‰å¤‡ç”¨æœåŠ¡æœºï¼Œ"),n("code",[t._v("web")]),t._v("æœåŠ¡å™¨ä¹Ÿæœ‰å¤‡ç”¨æœº")]),t._v(" "),n("p",[n("strong",[t._v("ç¼ºç‚¹")]),t._v("ï¼š è½¯ä»¶ä¸Šå’Œç¡¬ä»¶ä¸Šéƒ½å¯ä»¥å®ç°è´Ÿè½½å‡è¡¡ï¼Œé€‰æ‹©çš„æ—¶å€™è¦æ…é‡ï¼Œç¡¬ä»¶ä¸Šçš„è®¾å¤‡éœ€è¦èµ„é‡‘æŠ•å…¥ï¼Œè½¯ä»¶ä¸Šçš„è¦æ ¹æ®è‡ªå·±çš„éœ€æ±‚å†³å®šï¼Œå¦‚"),n("code",[t._v("LVS")]),t._v("ä¸èƒ½å®ç°åŠ¨é™åˆ†ç¦»ï¼›"),n("code",[t._v("NGINX")]),t._v("é€‚ç”¨èŒƒå›´å°ï¼Œåªèƒ½æ”¯æŒhttpï¼Œhttpsç­‰å°‘æ•°çš„åè®®ï¼›"),n("code",[t._v("HAProxy")]),t._v("ä¸æ”¯æŒ"),n("code",[t._v("POT/SMTP")]),t._v("åè®®ï¼Œå¤šè¿›ç¨‹æ¨¡å¼ä¸å¤Ÿå¥½ç­‰ã€‚")]),t._v(" "),n("div",{staticStyle:{"margin-top":"80px"}}),t._v(" "),n("h2",{attrs:{id:"nginxé›†ç¾¤åŸç†"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginxé›†ç¾¤åŸç†"}},[t._v("#")]),t._v(" nginxé›†ç¾¤åŸç†")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("åœ¨Nginxé›†ç¾¤ä¸­Nginxæ‰®æ¼”çš„è§’è‰²æ˜¯ï¼šåˆ†å‘å™¨")])]),t._v(" "),n("li",[n("p",[t._v("ä»»åŠ¡ï¼šæ¥å—è¯·æ±‚ã€åˆ†å‘è¯·æ±‚ã€å“åº”è¯·æ±‚")])]),t._v(" "),n("li",[n("p",[t._v("nginxé›†ç¾¤çš„å®è´¨\nnginx é»˜è®¤æ”¯æŒåˆ†å‘ ä»–æœ‰ä¸€ä¸ªè‡ªå¸¦æ¨¡å— å« "),n("code",[t._v("upstream")]),t._v(" è¿™å°±æ˜¯ "),n("code",[t._v("nginx")]),t._v(" çš„åˆ†å‘æ¨¡å—ï¼Œä¹Ÿå°±æ˜¯è¯´ "),n("code",[t._v("nginx")]),t._v(" åˆ†å‘æ˜¯ä¸€ä¸ªç»„åˆä½“ï¼Œè™šæ‹Ÿä¸»æœº+åå‘ä»£ç†+upstreamï¼Œåœ¨è¿™ä¸ªç»„åˆä¸­ï¼š")]),t._v(" "),n("ul",[n("li",[t._v("è™šæ‹Ÿä¸»æœºï¼šè´Ÿè´£æ¥å—å’Œå“åº”è¯·æ±‚ã€‚")]),t._v(" "),n("li",[t._v("åå‘ä»£ç†ï¼šå¸¦é¢†ç”¨æˆ·å»æ•°æ®æœåŠ¡å™¨æ‹¿æ•°æ®ã€‚")]),t._v(" "),n("li",[t._v("upstreamï¼šå‘Šè¯‰nginxå»å“ªä¸ªæ•°æ®æœåŠ¡å™¨æ‹¿æ•°æ®ã€‚")])])]),t._v(" "),n("li",[n("p",[t._v("æ•°æ®åŒ…èµ°å‘")])])]),t._v(" "),n("p",[t._v("â€‹ 1ï¼‰ç”¨æˆ·å‘èµ·è¯·æ±‚"),n("br"),t._v("\nâ€‹ 2ï¼‰è™šæ‹Ÿä¸»æœºæ¥å—ç”¨æˆ·è¯·æ±‚"),n("br"),t._v("\nâ€‹ 3ï¼‰è™šæ‹Ÿä¸»æœºå»æ‰¾åå‘ä»£ç†ï¼ˆé—®åå‘ä»£ç†å»å“ªæ‹¿æ•°æ®ï¼‰"),n("br"),t._v("\nâ€‹ 4ï¼‰åå‘ä»£ç†è®©å»æ‰¾upstream"),n("br"),t._v("\nâ€‹ 5ï¼‰upstreamå‘Šè¯‰ä¸€ä¸ªæ•°æ®æœåŠ¡å™¨IP"),n("br"),t._v("\nâ€‹ 6ï¼‰Nginxå»æ‰¾æ•°æ®æœåŠ¡å™¨ï¼Œå¹¶å‘èµ·ç”¨æˆ·çš„è¯·æ±‚"),n("br"),t._v("\nâ€‹ 7ï¼‰æ•°æ®æœåŠ¡å™¨æ¥å—è¯·æ±‚å¹¶å¤„ç†è¯·æ±‚"),n("br"),t._v("\nâ€‹ 8ï¼‰æ•°æ®æœåŠ¡å™¨å“åº”è¯·æ±‚ç»™Nginx"),n("br"),t._v("\nâ€‹ 9ï¼‰Nginxå“åº”è¯·æ±‚ç»™ç”¨æˆ·\n")]),n("div",{staticStyle:{"margin-top":"80px"}}),n("p"),t._v(" "),n("h2",{attrs:{id:"nginxåˆ†å‘ç®—æ³•"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginxåˆ†å‘ç®—æ³•"}},[t._v("#")]),t._v(" nginxåˆ†å‘ç®—æ³•")]),t._v(" "),n("h3",{attrs:{id:"ä»‹ç»"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ä»‹ç»"}},[t._v("#")]),t._v(" ä»‹ç»")]),t._v(" "),n("p",[t._v("å¦‚ä½•å°†ç”¨æˆ·è¯·æ±‚æŒ‰ç…§ä¸€å®šçš„è§„å¾‹åˆ†å‘ç»™ä¸šåŠ¡æœåŠ¡å™¨ã€‚ä¸»è¦åˆ†ä¸ºNginxé›†ç¾¤é»˜è®¤ç®—æ³•å’ŒåŸºäºè¯·æ±‚å¤´åˆ†å‘ç®—æ³•ã€‚")]),t._v(" "),n("h3",{attrs:{id:"nginxé›†ç¾¤é»˜è®¤ç®—æ³•"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginxé›†ç¾¤é»˜è®¤ç®—æ³•"}},[t._v("#")]),t._v(" nginxé›†ç¾¤é»˜è®¤ç®—æ³•")]),t._v(" "),n("h4",{attrs:{id:"è½®è¯¢ç®—æ³•-é»˜è®¤"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#è½®è¯¢ç®—æ³•-é»˜è®¤"}},[t._v("#")]),t._v(" è½®è¯¢ç®—æ³•(é»˜è®¤)")]),t._v(" "),n("p",[t._v("æ¯ä¸ªè¯·æ±‚æŒ‰æ—¶é—´é¡ºåºé€ä¸€åˆ†é…åˆ°ä¸åŒçš„åç«¯æœåŠ¡å™¨ï¼Œå¦‚æœåç«¯æœåŠ¡å™¨ "),n("code",[t._v("down")]),t._v(" æ‰ï¼Œèƒ½è‡ªåŠ¨å‰”é™¤ã€‚ç”¨äºå¤„ç†é™æ€é¡µé¢")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("upstream web "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  server "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v(".42")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n  server "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v(".43")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nserver "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  listen "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  server_name localhost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n  location "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    proxy_pass http"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("web"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" \n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("# "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("42")]),t._v("æœºå™¨downæ—¶è®¿é—®"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("43")]),t._v("æœºå™¨\nupstream web "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  server "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v(".42")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n  server "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v(".43")]),t._v(" backup"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nserver "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  listen "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  server_name localhost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n  location "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    proxy_pass http"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("web"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" \n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("div",{staticStyle:{"margin-top":"30px"}}),t._v(" "),n("h4",{attrs:{id:"åŸºäºæƒé‡"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#åŸºäºæƒé‡"}},[t._v("#")]),t._v(" åŸºäºæƒé‡")]),t._v(" "),n("p",[t._v("æŒ‡å®šæƒé‡ï¼Œæ•°å€¼å¤§çš„æœåŠ¡å™¨ï¼Œè·å¾—çš„è¯·æ±‚çš„æ•°é‡è¶Šå¤šï¼Œç”¨äºåç«¯æœåŠ¡å™¨æ€§èƒ½ä¸å‡çš„æƒ…å†µã€‚ç”¨äºå¤„ç†é™æ€é¡µé¢")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("# é€šè¿‡é…ç½®æƒé‡ï¼Œå¯ä»¥è®©æ€§èƒ½å¥½çš„æœåŠ¡å™¨æ‰¿æ‹…æ›´å¤šçš„è´Ÿè½½\nupstream web "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  # è®¾ç½®æƒé‡æ¯”ä¾‹"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n  server "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v(".42")]),t._v(" weight"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n  server "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v(".43")]),t._v(" weight"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nserver "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  listen "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  server_name localhost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n  location "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    proxy_pass http"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("web"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" \n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("div",{staticStyle:{"margin-top":"30px"}}),t._v(" "),n("h4",{attrs:{id:"åŸºäºip-hashåˆ†å‘"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#åŸºäºip-hashåˆ†å‘"}},[t._v("#")]),t._v(" åŸºäºip_hashåˆ†å‘")]),t._v(" "),n("p",[t._v("æ¯ä¸ªè¯·æ±‚æŒ‰è®¿é—®ipçš„hashç»“æœåˆ†é…ï¼Œè¿™æ ·æ¯ä¸ªè®¿å®¢å›ºå®šè®¿é—®ä¸€ä¸ªåç«¯æœåŠ¡ï¼Œå¥½å¤„æ˜¯å¯ä»¥è§£å†³sessionçš„é—®é¢˜ã€‚å¯ä»¥å¤„ç†åŠ¨æ€ç½‘ç«™ã€‚")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("# ip_hashç®—æ³•èƒ½å¤Ÿä¿è¯æ¥è‡ªåŒæ ·æºåœ°å€çš„è¯·æ±‚éƒ½åˆ†å‘åˆ°åŒä¸€å°ä¸»æœºã€‚éœ€è¦æ³¨æ„ï¼šip_hashç®—æ³•ä¸æ”¯æŒbackupã€weightè®¾ç½®ã€‚é»˜è®¤æƒé‡ä¸º"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("ã€‚\nupstream web "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n  ip_hash"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("    # æŒ‡å®šip_hashå³å¯ï¼Œé»˜è®¤weightæƒé‡æ¯”ä¾‹"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n  server "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v(".42")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  server "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v(".43")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nserver "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n  listen "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  server_name localhost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n  location "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    proxy_pass http"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("web"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" \n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("div",{staticStyle:{"margin-top":"30px"}}),t._v(" "),n("h4",{attrs:{id:"åŸºäºurlçš„hash"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#åŸºäºurlçš„hash"}},[t._v("#")]),t._v(" åŸºäºurlçš„hash")]),t._v(" "),n("p",[t._v("æŒ‰è®¿é—®urlçš„hashç»“æœæ¥åˆ†é…è¯·æ±‚ï¼Œä½¿æ¯ä¸ªurlå®šå‘åˆ°åŒä¸€ä¸ªåç«¯æœåŠ¡ ï¼Œåç«¯æœåŠ¡å™¨ä¸ºç¼“å­˜æ—¶æ¯”è¾ƒæœ‰æ•ˆã€‚")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("# ä¸åŒçš„"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("URL")]),t._v("æˆ‘å»æ‰¾ä¸åŒçš„æœºå™¨è®¿é—®ï¼Œå°±æ˜¯æŠŠurlè®¡ç®—å‡ºä¸€ä¸ªå€¼ç„¶åé™¤ä»¥æœºå™¨çš„æ•°é‡å–ä½™ ï¼Œéœ€è¦å®‰è£…ç¬¬ä¸‰æ–¹æ’ä»¶\nworker_processes  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nevents "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  worker_connections  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nhttp "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  include       mime"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("types"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  default_type  application"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("octet"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("stream"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  sendfile        on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  keepalive_timeout  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("65")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  upstream web "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    consistent_hash $request_uri"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    server "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v(".42")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    server "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v(".43")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  server "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    listen       "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    server_name  localhost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    location "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      proxy_pass http"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("web"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    error_page   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("500")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("502")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("504")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v("x"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    location "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v("x"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      root   html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("div",{staticStyle:{"margin-top":"80px"}}),t._v(" "),n("h2",{attrs:{id:"nginxåŸºäºè¯·æ±‚å¤´çš„åˆ†å‘"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginxåŸºäºè¯·æ±‚å¤´çš„åˆ†å‘"}},[t._v("#")]),t._v(" nginxåŸºäºè¯·æ±‚å¤´çš„åˆ†å‘")]),t._v(" "),n("h3",{attrs:{id:"ä»‹ç»-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ä»‹ç»-2"}},[t._v("#")]),t._v(" ä»‹ç»")]),t._v(" "),n("p",[t._v("å‰é¢çš„åˆ†å‘æ–¹å¼éƒ½æ˜¯åŸºäºä¸€ä¸ªé›†ç¾¤åˆ†å‘çš„ï¼Œnginxæ˜¯ä¸€ä¸ªåŸºäº7å±‚çš„åˆ†å‘ä¹Ÿå°±æ˜¯å¯ä»¥å®ç°åŸºäºä¸»æœºå¤´çš„åˆ†å‘ï¼Œè¿™ç§åˆ†å‘ä¸€èˆ¬éƒ½æ˜¯ç”¨äºå¤šé›†ç¾¤ç¯å¢ƒä¸­ã€‚\n")]),n("div",{staticStyle:{"margin-top":"50px"}}),n("p"),t._v(" "),n("h3",{attrs:{id:"åŸºäºè¯·æ±‚å¤´åˆ†å‘ç®—æ³•"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#åŸºäºè¯·æ±‚å¤´åˆ†å‘ç®—æ³•"}},[t._v("#")]),t._v(" åŸºäºè¯·æ±‚å¤´åˆ†å‘ç®—æ³•")]),t._v(" "),n("h4",{attrs:{id:"åŸºäºhoståˆ†å‘"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#åŸºäºhoståˆ†å‘"}},[t._v("#")]),t._v(" åŸºäºhoståˆ†å‘")]),t._v(" "),n("p",[t._v("åŸºäº "),n("code",[t._v("host")]),t._v(" åˆ†å‘è¿™ç§åˆ†å‘æ–¹å¼é€‚ç”¨äºå¤šé›†ç¾¤åˆ†å‘ã€‚ä¾‹å¦‚ï¼šä¸€ä¸ªå…¬å¸æœ‰å¤šä¸ªç½‘ç«™ï¼Œæ¯ä¸ªç½‘ç«™å°±æ˜¯ä¸€ä¸ªé›†ç¾¤ã€‚")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("#nginxåˆ†å‘å™¨è®¾ç½®\nhttp "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  upstream web1 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("   # åä¸ºweb1çš„åå‘ä»£ç†ç¾¤ç»„\n    server "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v(".42")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  upstream web2 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("   # åä¸ºweb2çš„åå‘ä»£ç†ç¾¤ç»„\n    server "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v(".43")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  server "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("    # web1è™šæ‹Ÿä¸»æœº\n    listen "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    server_name www"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("web1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("    # åŸºäºåŸŸååˆ†å‘å¿…é¡»æœ‰åŸŸå\n    location "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      proxy_pass http"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("web1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  server "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("    # web2è™šæ‹Ÿä¸»æœº\n    listen "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    server_name www"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("web2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("    # åŸºäºåŸŸååˆ†å‘å¿…é¡»æœ‰åŸŸå \n    location "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      proxy_pass http"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("web2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("div",{staticStyle:{"margin-top":"30px"}}),t._v(" "),n("h4",{attrs:{id:"åŸºäºå¼€å‘è¯­è¨€åˆ†å‘"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#åŸºäºå¼€å‘è¯­è¨€åˆ†å‘"}},[t._v("#")]),t._v(" åŸºäºå¼€å‘è¯­è¨€åˆ†å‘")]),t._v(" "),n("p",[t._v("è¿™ç§åˆ†å‘æ–¹å¼é€‚ç”¨äºæ··åˆå¼€å‘çš„ç½‘ç«™ï¼ŒæŸäº›å¤§å‹ç½‘ç«™æ—¢æœ‰ "),n("code",[t._v("php")]),t._v(" ä¹Ÿæœ‰ "),n("code",[t._v("jsp")]),t._v(" ï¼Œå°±å¯ä»¥åŸºäºå¼€å‘è¯­è¨€åˆ†å‘ã€‚")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("http "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  upstream php "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    server "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v(".42")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  upstream html "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    server "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v(".43")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  server "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    location "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("~")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" \\"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("php$ "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("    # ä»¥phpç»“å°¾çš„\n      proxy_pass http"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("php"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" \n    location "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("~")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" \\"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html$ "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("   # ä»¥htmlç»“å°¾çš„\n      proxy_pass http"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("div",{staticStyle:{"margin-top":"30px"}}),t._v(" "),n("h4",{attrs:{id:"åŸºäºæµè§ˆå™¨åˆ†å‘"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#åŸºäºæµè§ˆå™¨åˆ†å‘"}},[t._v("#")]),t._v(" åŸºäºæµè§ˆå™¨åˆ†å‘")]),t._v(" "),n("p",[t._v("è¿™ç§åŸºäºæµè§ˆå™¨çš„åˆ†å‘ï¼Œå¸¸åº”ç”¨äº "),n("code",[t._v("PC")]),t._v(" ç«¯å’Œç§»åŠ¨ç«¯åŒºåˆ†æˆ–æµè§ˆå™¨é€‚é…ã€‚")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("upstream curl "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" server "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v(".42")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nupstream firefox "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" server "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v(".43")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nupstream other "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" server "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v(".44")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nserver "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  listen "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  server_name www"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("web1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  location "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    proxy_pass http"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("other"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" $http_user_agent "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("~")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" curl "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      proxy_pass http"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("curl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" $http_user_agent "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("~")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" firefox "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      proxy_pass http"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("firefox"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("div",{staticStyle:{"margin-top":"30px"}}),t._v(" "),n("h4",{attrs:{id:"åŸºäºæºipåˆ†å‘"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#åŸºäºæºipåˆ†å‘"}},[t._v("#")]),t._v(" åŸºäºæºIPåˆ†å‘")]),t._v(" "),n("p",[t._v("åƒè…¾è®¯æ–°é—»ï¼Œç½‘æ˜“ï¼Œ58åŒåŸï¼ŒçœŸçˆ±ï¼Œç™¾åˆï¼Œèµ¶é›†ï¼Œæ™ºè”ç­‰ç­‰å¾ˆå¤šç½‘ç«™,è¿™ç§ç½‘ç«™éƒ½æœ‰ä¸€ä¸ªç‰¹æ€§ï¼Œä½ ä¸€è®¿é—®ï¼Œå°±çŸ¥é“ä½ çš„ä½ç½®ï¼Œç„¶åæ ¹æ®ä½ çš„ä½ç½®ï¼Œç»™ä½ æ¨èæˆ–è€…å±•ç¤ºç›¸å…³å†…å®¹ã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥è®©æœåŠ¡å™¨å¯¹æº "),n("code",[t._v("IP")]),t._v(" è¿›è¡Œåˆ¤æ–­ï¼Œæ ¹æ®åˆ¤æ–­çš„ç»“æœä¸åŒï¼Œå†è¿”å›ä¸åŒçš„æ•°æ®ç»™å®¢æˆ·ç«¯ï¼›å¦‚æœåˆ¤æ–­ä¸å‡ºæ¥ï¼Œå°±æŒ‰ç…§é»˜è®¤å»å¤„ç†ã€‚å¦‚æœæƒ³å®ç°åŸºäºæº "),n("code",[t._v("IP")]),t._v(" çš„åˆ†å‘æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå« "),n("code",[t._v("geo")]),t._v(" çš„å‚æ•°ï¼Œè¿™ä¸ªå‚æ•°å¯ä»¥è¦æ ¹æ®å®¢æˆ·ç«¯ "),n("code",[t._v("ip")]),t._v(" è®¿é—®åˆ°ä¸åŒçš„ "),n("code",[t._v("server")]),t._v("ï¼Œå®ƒæ˜¯é€šè¿‡ä¸€ä¸ªå«"),n("code",[t._v("ngx_http_geo_module")]),t._v(" æ¨¡å—æä¾›çš„ã€‚")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("upstream bj"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("server "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  server "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v(".42")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("    # web01\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nupstream sh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("server "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  server "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v(".43")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("      # web02\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nupstream "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("server "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  server "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v(".44")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("      # web03\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\ngeo $geo "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("       # "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("IP")]),t._v("åº“\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v(".10")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("32")]),t._v(" bj"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("    # åŒ—äº¬\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v(".20")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("32")]),t._v(" sh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   # ä¸Šæµ·\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nserver "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  listen  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  server_name   www"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("web1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  location "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    proxy_pass http"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("$geo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("server$request_uri"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("å¦‚æœå®¢æˆ·ç«¯åœ°å€æ˜¯ "),n("em",[t._v("0.10")]),t._v(" å°±è®¿é—®åŒ—äº¬ï¼Œå¦‚æœæ˜¯ "),n("em",[t._v("0.20")]),t._v(" å°±è®¿é—®ä¸Šæµ·ï¼Œå¦‚æœä¸æ˜¯ "),n("em",[t._v("0.10")]),t._v(" ä¹Ÿä¸æ˜¯ "),n("em",[t._v("0.20")]),t._v(" å°±æŒ‰ç…§ "),n("code",[t._v("default")]),t._v(" å¤„ç†ï¼Œçº¿ä¸Šç¯å¢ƒè¿™é‡Œé¢å°±æ˜¯ä¸ª "),n("code",[t._v("IP")]),t._v(" åº“ æˆ‘ç°åœ¨æ²¡æœ‰ "),n("code",[t._v("ip")]),t._v(" åº“åªèƒ½å†™ä¸¤ä¸ª "),n("code",[t._v("IP")]),t._v(" æ¥ä»£è¡¨çœ‹ä¸‹åé¢çš„æ©ç æ˜¯32è¡¨ç¤ºè¿™ä¸€ä¸ªç½‘æ®µåªæœ‰è¿™ä¸€ä¸ª "),n("code",[t._v("IP")]),t._v(" å§ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥æ¢æˆç½‘æ®µã€‚")]),t._v(" "),n("p",[n("code",[t._v("http")]),t._v(" åé¢åŠ ä¸Š "),n("code",[t._v("$request_uri")]),t._v(" çš„åŸå› å°±æ˜¯é¿å…å®¢æˆ· æ‰¾ä½ æ‹¿æ•°æ®çš„æ—¶å€™ä¸€æŒ‡å®š "),n("code",[t._v("URI")]),t._v(" ä½ å°±æ— æ³•æ­£å¸¸ä»£ç†äº†ï¼Œç›®çš„å°±æ˜¯ä¿è¯å®¢æˆ·åœ¨è®¿é—®ç±»ä¼¼ "),n("code",[t._v("http://www.a.com/a/b/c/d.jpg")]),t._v(" è¿™æ ·çš„ç½‘å€çš„æ—¶å€™å¯ä»¥æ­£å¸¸è®¿é—® ä¹Ÿå°±æ˜¯è¯´å½“ç”¨æˆ·è¯·æ±‚çš„ "),n("code",[t._v("URL")]),t._v(" å½“ä¸­çš„ "),n("code",[t._v("URI")]),t._v(" è·Ÿç€å˜åŒ–çš„æ—¶å€™ä½ çš„ä»£ç†æœåŠ¡å™¨ä¸€æ ·å¯ä»¥æ­£å¸¸å·¥ä½œ\n")]),n("div",{staticStyle:{"margin-top":"50px"}}),n("p"),t._v(" "),n("h3",{attrs:{id:"ğŸ”—ç›¸å…³é“¾æ¥"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ”—ç›¸å…³é“¾æ¥"}},[t._v("#")]),t._v(" ğŸ”—ç›¸å…³é“¾æ¥")]),t._v(" "),n("p",[n("a",{attrs:{href:"https://www.zutuanxue.com/home/4/9_393",target:"_blank",rel:"noopener noreferrer"}},[t._v("ç»„å›¢å­¦"),n("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=r.exports}}]);