### é…ç½®æ–‡ä»¶è¯¦è§£
***

### nginx æ–‡ä»¶ç»“æ„
- å…¨å±€å—ï¼šé…ç½®å½±å“nginxå…¨å±€çš„æŒ‡ä»¤ã€‚ä¸€èˆ¬æœ‰è¿è¡ŒnginxæœåŠ¡å™¨çš„ç”¨æˆ·ç»„ï¼Œnginxè¿›ç¨‹pidå­˜æ”¾è·¯å¾„ï¼Œæ—¥å¿—å­˜æ”¾è·¯å¾„ï¼Œé…ç½®æ–‡ä»¶å¼•å…¥ï¼Œå…è®¸ç”Ÿæˆworker processæ•°ç­‰ã€‚
- eventså—ï¼šé…ç½®å½±å“nginxæœåŠ¡å™¨æˆ–ä¸ç”¨æˆ·çš„ç½‘ç»œè¿æ¥ã€‚æœ‰æ¯ä¸ªè¿›ç¨‹çš„æœ€å¤§è¿æ¥æ•°ï¼Œé€‰å–å“ªç§äº‹ä»¶é©±åŠ¨æ¨¡å‹å¤„ç†è¿æ¥è¯·æ±‚ï¼Œæ˜¯å¦å…è®¸åŒæ—¶æ¥å—å¤šä¸ªç½‘è·¯è¿æ¥ï¼Œå¼€å¯å¤šä¸ªç½‘ç»œè¿æ¥åºåˆ—åŒ–ç­‰ã€‚
- httpå—ï¼šå¯ä»¥åµŒå¥—å¤šä¸ªserverï¼Œé…ç½®ä»£ç†ï¼Œç¼“å­˜ï¼Œæ—¥å¿—å®šä¹‰ç­‰ç»å¤§å¤šæ•°åŠŸèƒ½å’Œç¬¬ä¸‰æ–¹æ¨¡å—çš„é…ç½®ã€‚å¦‚æ–‡ä»¶å¼•å…¥ï¼Œmime-typeå®šä¹‰ï¼Œæ—¥å¿—è‡ªå®šä¹‰ï¼Œæ˜¯å¦ä½¿ç”¨sendfileä¼ è¾“æ–‡ä»¶ï¼Œè¿æ¥è¶…æ—¶æ—¶é—´ï¼Œå•è¿æ¥è¯·æ±‚æ•°ç­‰ã€‚
- serverå—ï¼šé…ç½®è™šæ‹Ÿä¸»æœºçš„ç›¸å…³å‚æ•°ï¼Œä¸€ä¸ªhttpä¸­å¯ä»¥æœ‰å¤šä¸ªserverã€‚
- locationå—ï¼šé…ç½®è¯·æ±‚çš„è·¯ç”±ï¼Œä»¥åŠå„ç§é¡µé¢çš„å¤„ç†æƒ…å†µã€‚

```js
...              #å…¨å±€å—

events {         #eventså—
   ...
}

http      #httpå—
{
    ...   #httpå…¨å±€å—
    server        #serverå—
    { 
        ...       #serverå…¨å±€å—
        location [PATTERN]   #locationå—
        {
            ...
        }
        location [PATTERN] 
        {
            ...
        }
    }
    server
    {
      ...
    }
    ...     #httpå…¨å±€å—
}
```
<div style='margin-top: 50px'></div>


### æ¨¡å—è¯¦è§£
#### å…¨å±€å—
```js
#å¯åŠ¨å­è¿›ç¨‹ç¨‹åºé»˜è®¤ç”¨æˆ·æˆ–è€…ç»„ï¼Œé»˜è®¤ä¸ºnobody nobody
#user  nobody;

#ä¸€ä¸ªä¸»è¿›ç¨‹å’Œå¤šä¸ªå·¥ä½œè¿›ç¨‹ã€‚å·¥ä½œè¿›ç¨‹æ˜¯å•è¿›ç¨‹çš„ï¼Œä¸”ä¸éœ€è¦ç‰¹æ®Šæˆæƒå³å¯è¿è¡Œï¼›è¿™é‡Œå®šä¹‰çš„æ˜¯å·¥ä½œè¿›ç¨‹æ•°é‡ï¼Œé€šå¸¸è®¾ç½®æˆå’Œcpuçš„æ•°é‡ç›¸ç­‰
worker_processes  1;

#å…¨å±€é”™è¯¯æ—¥å¿—çš„ä½ç½®åŠæ—¥å¿—çº§åˆ«ã€‚è¿™ä¸ªè®¾ç½®å¯ä»¥æ”¾å…¥å…¨å±€å—ï¼Œhttpå—ï¼Œserverå—ï¼Œçº§åˆ«ä»¥æ­¤ä¸ºï¼šdebug|info|notice|warn|error|crit|alert|emerg
#error_log  logs/error.log;
#error_log  logs/error.log  notice;
#error_log  logs/error.log  info;

#æŒ‡å®šnginxè¿›ç¨‹è¿è¡Œæ–‡ä»¶å­˜æ”¾åœ°å€
#pid        logs/nginx.pid;
```

#### eventså—
```js
events {
    accept_mutex on;   #è®¾ç½®ç½‘è·¯è¿æ¥åºåˆ—åŒ–ï¼Œé˜²æ­¢æƒŠç¾¤ç°è±¡å‘ç”Ÿï¼Œé»˜è®¤ä¸ºon
    multi_accept on;  #è®¾ç½®ä¸€ä¸ªè¿›ç¨‹æ˜¯å¦åŒæ—¶æ¥å—å¤šä¸ªç½‘ç»œè¿æ¥ï¼Œé»˜è®¤ä¸ºoff
    #use epoll;      #äº‹ä»¶é©±åŠ¨æ¨¡å‹ï¼Œselect|poll|kqueue|epoll|resig|/dev/poll|eventport
    worker_connections  1024;    #å•ä¸ªè¿›ç¨‹æœ€å¤§è¿æ¥æ•°
}
```

#### httpå—
```js
http {
    #æ–‡ä»¶æ‰©å±•åä¸æ–‡ä»¶ç±»å‹æ˜ å°„è¡¨ã€‚`Nginx`é€šè¿‡æœåŠ¡å™¨ç«¯æ–‡ä»¶çš„åç¼€åå’Œ`mime.type`æ¥åˆ¤æ–­è¿™ä¸ªæ–‡ä»¶å±äºä»€ä¹ˆç±»å‹ï¼Œå†å°†è¯¥æ•°æ®ç±»å‹å†™å…¥`HTTP`å¤´éƒ¨çš„`Content-Typ`eå­—æ®µä¸­ï¼Œå‘é€ç»™å®¢æˆ·ç«¯ã€‚
    include       mime.types;

    #é»˜è®¤æ–‡ä»¶ç±»å‹ï¼Œé»˜è®¤ä¸ºtext/plain
    default_type  application/octet-stream;

    #æ—¥å¿—æ ¼å¼
    #log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
    #                  '$status $body_bytes_sent "$http_referer" '
    #                  '"$http_user_agent" "$http_x_forwarded_for"';

    #å…¨å±€è®¿é—®æ—¥å¿—è·¯å¾„ 
    #access_log  logs/access.log  main;

    #sendfileæŒ‡ä»¤æŒ‡å®š nginx æ˜¯å¦è°ƒç”¨sendfile å‡½æ•°ï¼ˆzero copy æ–¹å¼ï¼‰æ¥è¾“å‡ºæ–‡ä»¶ï¼Œå¯¹äºæ™®é€šåº”ç”¨ï¼Œå¿…é¡»è®¾ä¸ºonã€‚å¦‚æœç”¨æ¥è¿›è¡Œä¸‹è½½ç­‰åº”ç”¨ç£ç›˜IOé‡è´Ÿè½½åº”ç”¨ï¼Œå¯è®¾ç½®ä¸ºoffï¼Œä»¥å¹³è¡¡ç£ç›˜ä¸ç½‘ç»œIOå¤„ç†é€Ÿåº¦ï¼Œé™ä½ç³»ç»Ÿuptimeã€‚
    sendfile        on;
    
    #æ­¤é€‰é¡¹å…è®¸æˆ–ç¦æ­¢ä½¿ç”¨sockeçš„TCP_CORKçš„é€‰é¡¹ï¼Œæ­¤é€‰é¡¹ä»…åœ¨ä½¿ç”¨sendfileçš„æ—¶å€™ä½¿ç”¨
    #tcp_nopush     on;

    #é•¿è¿æ¥è¶…æ—¶æ—¶é—´
    #keepalive_timeout  0;
    keepalive_timeout  65;

    #å¼€å¯å‹ç¼©
    #gzip  on;
}
```

:::details æ—¥å¿—æ ¼å¼å‚æ•°
- $remote_addrä¸$http_x_forwarded_forç”¨ä»¥è®°å½•å®¢æˆ·ç«¯çš„ipåœ°å€ï¼›
- $remote_userï¼šç”¨æ¥è®°å½•å®¢æˆ·ç«¯ç”¨æˆ·åç§°ï¼›
- $time_localï¼š ç”¨æ¥è®°å½•è®¿é—®æ—¶é—´ä¸æ—¶åŒºï¼›
- $requestï¼š ç”¨æ¥è®°å½•è¯·æ±‚çš„urlä¸httpåè®®ï¼›
- $statusï¼š ç”¨æ¥è®°å½•è¯·æ±‚çŠ¶æ€ï¼›æˆåŠŸæ˜¯200ï¼Œ
- $body_bytes_sent ï¼šè®°å½•å‘é€ç»™å®¢æˆ·ç«¯æ–‡ä»¶ä¸»ä½“å†…å®¹å¤§å°ï¼›
- $http_refererï¼šç”¨æ¥è®°å½•ä»é‚£ä¸ªé¡µé¢é“¾æ¥è®¿é—®è¿‡æ¥çš„ï¼›
- $http_user_agentï¼šè®°å½•å®¢æˆ·æµè§ˆå™¨çš„ç›¸å…³ä¿¡æ¯ï¼›
:::

#### serverå—
```js
server {
    #è™šæ‹Ÿä¸»æœºä½¿ç”¨çš„ç«¯å£
    listen       80;

    #è™šæ‹Ÿä¸»æœºåŸŸå
    server_name  localhost;

    #è™šæ‹Ÿä¸»æœºæ”¯æŒçš„å­—ç¬¦é›†
    #charset koi8-r;

    #è™šæ‹Ÿä¸»æœºçš„è®¿é—®æ—¥å¿—è·¯å¾„
    #access_log  logs/host.access.log  main;

    #å®šä¹‰webæ ¹è·¯å¾„
    location / {
    }
}
```

#### locationå—
```js
location / {
    #æ ¹ç›®å½•è·¯å¾„
    root   html;

    #ç´¢å¼•é¡µ
    index  index.html index.htm;
}
```
<div style='margin-top: 50px'></div>


### ğŸ”— ç›¸å…³é“¾æ¥
- [nginxè¯¦ç»†é…ç½®](https://www.runoob.com/w3cnote/nginx-setup-intro.html)
- [nginx.confé…ç½®æ–‡ä»¶è¯¦è§£](https://juejin.cn/post/6844903741678698510)
- [mime.types](http://www.360doc.com/content/19/0226/16/59494473_817687698.shtml)
- [internal](https://blog.huangfeiqiao.com/archives/nginx-internal-redirect.html)