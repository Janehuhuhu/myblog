### 组件库
***

### 简介
组件库本质上是一种 `npm` 包，针对可复用的组件做的一种打包工作
<div style='margin-top: 50px'></div>

### 开发
#### webpack 入口文件
1. 对于多 `package` 模式（src/packages），这是整体的入口文件
```js
import Index from './packages/demo/index.js'
const components = [Index]
const install = function(Vue) {
  components.forEach(item => {
    if (item.install) {
      Vue.use(item)
    } else if (item.name) {
      Vue.component(item.name, item)
    }
  })
}

// 自动安装 方便打包成压缩文件, 用<script scr=''></script>的方式引用
if (typeof window !== 'undefined' && window.Vue) {
  install(window.Vue)
}
// 注意这种导出方式，后面会说到
export default {
  install,
  Index,
}
```

2. 单个 `pacakge` 打包入口文件：
```js
import MyComponent1 from './index.vue'

/* istanbul ignore next */
MyComponent1.install = function(Vue) {
  Vue.component(MyComponent1.name, MyComponent1)
}
export default MyComponent1
```
<div style='margin-top: 50px'></div>

### 引入方式
#### 按需引入单个包
```js
import MyCompList from '@nibfe/pattern-select/build/es/packages/parttern-list/index.js’. 
Vue.use(MyCompList)
```

#### 引入全部包
这种引入方式一定要保证在 1 中的入口文件中包含要引入的组件，如 `Index`
```js
import MyComp from '@nibfe/pattern-select'
Vue.use(MyComp)
```

#### 按需引入
**1中export default** 的导出方式不能用 {} 的方式引入，必须用 `export` 的方式导出才能用 {} 导入
```js
import { MyComp } from '@nibfe/pattern-select'
Vue.use(MyComp)
```

如果想要用 {} 按需引入的方式，那就必须要引入 `babel-plugin-import`
```js
module.exports = {
  presets: ['@vue/app'],
  plugins: [
    [
      'import',
      {
        libraryName: '@nibfe/vault',
        customStyleName(name) {
          return `@nibfe/vault/build/styles/${name}.css`
        },
        customName(name) {
          return `@nibfe/vault/build/es/${name}/${name}.js`
        },
      },
    ],
  ],
}
```
<div style='margin-top: 50px'></div>

### 组件库打包
打包工具用的是 `rollup`。打包方法 `CJS, AMD, UMD 和 ESM`, 其中 `AMD` 说的异步是下载时不会阻塞其他进程，就像是 `script` 中的 `async`。具体详细看👇下面链接
<div style='margin-top: 50px'></div>

### 引入第三方库
需要注意的是，如果想要按需引入，必须打包的结果中有按单包打包的，也有整体打包的结果。这就是为什么 `packages` 目录外有 `index.js` 入口文件，子目录中也有入口文件的原因。那么该如何引入第三方库呢，如果是局部引入，在 `packages` 子包的 `.vue` 中引入即可。
```js
// src/packages/xx/index.vue
import '@ss/mtd-vue/lib/theme2/index.css'

// 按需引入
import a from '../build/es/packages/demo/index.js'
```

如果是全局引入，必须在全局的打包入口文件中（src/index.js）中引入，打包出的结果也只能全局引入，不能按需引入，因为在按需打包的文件中不会包含全局的文件。注意：`entry/main` 中是测试文件，方便本地测试组件库的，不会写入到最后的打包结果中
```js
// src/index.js
import '@ss/mtd-vue/lib/theme2/index.css'

// 打包结果引入，全局引入
import a from '../build/es/index.es'
Vue.use(a)
```
为了防止第三方库二次打包（原包打包过一次），需要在组件库打包的时候排除掉
```js
// vue.config.js
pluginOptions: {
  romeLibrary: {
    rollupOptions: {
      external: [/@ss\/mtd-vue/, /@nibfe\/dz-form/], // 此处举例,其中/@gfe/,/@hfe/是通过正则的方式匹配，'@/lib/axios'字符串方式是匹配同名第三方包
    },
  },
},
```
<div style='margin-top: 50px'></div>

### 🔗相关链接
- [babel-plugin-import](https://www.npmjs.com/package/babel-plugin-import)
- [手把手教你开发组件](https://juejin.cn/post/6844903459536240648)
- [简单实现 babel-plugin-import](https://juejin.cn/post/6905708824703795214)
- [CJS, AMD, UMD 和 ESM](https://juejin.cn/post/6935973925004247077)
- [AMD、CJS](http://www.360doc.com/content/19/0519/15/13328254_836725029.shtml)
- [webpack和rollup](https://juejin.cn/post/6844903735236247565)
- [rollup](https://www.rollupjs.com/)
- [rollup配置文件](https://blog.cjw.design/blog/old/rollup#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E9%80%89%E9%A1%B9%E8%AF%A6%E8%A7%A3)

